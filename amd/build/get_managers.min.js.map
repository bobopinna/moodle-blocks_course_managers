{"version":3,"file":"get_managers.min.js","sources":["../src/get_managers.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the list of courses managers.\n *\n * @module      block_course_managers/get_managers\n * @copyright   2023 Roberto Pinna\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {call as fetchMany} from 'core/ajax';\nimport {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nconst Selectors = {\n    filter: \"#block-course_managers-search-filter\",\n    list: \"#block-course_managers-list\",\n};\n\nexport const init = async(blockId) => {\n    Templates.appendNodeContents(Selectors.list, '<i class=\"fa-solid fa-circle-notch fa-spin fa-xl\"></i>', '');\n\n    const managers = await getManagers(blockId);\n\n    if (managers !== null) {\n        displayManagers(managers, Selectors.list, null);\n\n        document.addEventListener(\"keyup\", e => {\n            if (e.target.closest(Selectors.filter)) {\n                displayManagers(managers, Selectors.list, Selectors.filter);\n            }\n        });\n    }\n};\n\n/**\n * Load the list of managers.\n *\n * @param {Number} blockId Current block instance id.\n */\nexport const getManagers = (blockId) => {\n    const managers = fetchMany([{\n        methodname: 'block_course_managers_get_managers',\n        args: {blockid: blockId},\n    }]);\n    return managers[0];\n};\n\n/**\n * Display the list of filtered managers.\n *\n * @param {Array} managers The list of site managers.\n * @param {String} listSelector The HTML element selector for output the list.\n * @param {String} filterSelector The HTML element selector to get filter value.\n **/\nconst displayManagers = (managers, listSelector, filterSelector) => {\n    let query = null;\n    if (filterSelector !== null) {\n        query = document.querySelector(filterSelector).value;\n    }\n\n    if (managers.length > 0) {\n        let counter = 0;\n        managers.forEach(manager => {\n            if (counter == 0) {\n                document.querySelectorAll(listSelector + \" *\").forEach(n => n.remove());\n                Templates.appendNodeContents(listSelector, '<ul></ul>', '');\n            }\n            if ((query === null) || manager.fullname.includes(query)) {\n                Templates.renderForPromise('block_course_managers/manager_element', manager)\n                .then(({html, js}) => {\n                    Templates.appendNodeContents(listSelector + ' ul', html, js);\n                    counter++;\n                })\n                .catch((error) => displayException(error));\n            }\n        });\n    }\n};\n"],"names":["Selectors","async","appendNodeContents","managers","getManagers","blockId","displayManagers","document","addEventListener","e","target","closest","methodname","args","blockid","listSelector","filterSelector","query","querySelector","value","length","counter","forEach","manager","querySelectorAll","n","remove","fullname","includes","renderForPromise","then","_ref","html","js","catch","error"],"mappings":";;;;;;;2KA2BMA,iBACM,uCADNA,eAEI,4CAGUC,MAAAA,6BACNC,mBAAmBF,eAAgB,yDAA0D,UAEjGG,eAAiBC,YAAYC,SAElB,OAAbF,WACAG,gBAAgBH,SAAUH,eAAgB,MAE1CO,SAASC,iBAAiB,SAASC,IAC3BA,EAAEC,OAAOC,QAAQX,mBACjBM,gBAAgBH,SAAUH,eAAgBA,6BAW7CI,YAAeC,UACP,cAAU,CAAC,CACxBO,WAAY,qCACZC,KAAM,CAACC,QAAST,YAEJ,0CAUdC,gBAAkB,CAACH,SAAUY,aAAcC,sBACzCC,MAAQ,QACW,OAAnBD,iBACAC,MAAQV,SAASW,cAAcF,gBAAgBG,OAG/ChB,SAASiB,OAAS,EAAG,KACjBC,QAAU,EACdlB,SAASmB,SAAQC,UACE,GAAXF,UACAd,SAASiB,iBAAiBT,aAAe,MAAMO,SAAQG,GAAKA,EAAEC,8BACpDxB,mBAAmBa,aAAc,YAAa,MAE7C,OAAVE,OAAmBM,QAAQI,SAASC,SAASX,4BACpCY,iBAAiB,wCAAyCN,SACnEO,MAAKC,WAACC,KAACA,KAADC,GAAOA,4BACA/B,mBAAmBa,aAAe,MAAOiB,KAAMC,IACzDZ,aAEHa,OAAOC,QAAU,2BAAiBA"}